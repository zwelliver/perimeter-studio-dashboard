const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DetailModal-BsqAyIVa.js","assets/date-vendor-QvLKA523.js","assets/chart-vendor-nXq5J5EI.js","assets/pdf-vendor-CwNtiuTz.js","assets/csv-vendor-NuAurQ9B.js","assets/DetailModal-DRfyYF59.css","assets/ProjectInsights-CMS8qvkk.js","assets/ProjectInsights-C9HUBvzC.css"])))=>i.map(i=>d[i]);
var te=Object.defineProperty;var ae=(s,t,r)=>t in s?te(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r;var K=(s,t,r)=>ae(s,typeof t!="symbol"?t+"":t,r);import{r as m,a as re,R as ie}from"./chart-vendor-nXq5J5EI.js";import{E as ne,h as oe,_ as X}from"./pdf-vendor-CwNtiuTz.js";import{p as q,d as le,f as W,a as R,b as ce}from"./date-vendor-QvLKA523.js";import{P as de}from"./csv-vendor-NuAurQ9B.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();var Z={exports:{}},I={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var me=m,he=Symbol.for("react.element"),ue=Symbol.for("react.fragment"),pe=Object.prototype.hasOwnProperty,xe=me.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,je={key:!0,ref:!0,__self:!0,__source:!0};function ee(s,t,r){var a,n={},o=null,c=null;r!==void 0&&(o=""+r),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(c=t.ref);for(a in t)pe.call(t,a)&&!je.hasOwnProperty(a)&&(n[a]=t[a]);if(s&&s.defaultProps)for(a in t=s.defaultProps,t)n[a]===void 0&&(n[a]=t[a]);return{$$typeof:he,type:s,key:o,ref:c,props:n,_owner:xe.current}}I.Fragment=ue;I.jsx=ee;I.jsxs=ee;Z.exports=I;var e=Z.exports,B={},G=re;B.createRoot=G.createRoot,B.hydrateRoot=G.hydrateRoot;const ve=()=>{const[s,t]=m.useState(()=>{if(typeof window<"u"){const n=localStorage.getItem("studio-theme");return n==="light"||n==="dark"?n:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}return"dark"});return m.useEffect(()=>{document.documentElement.setAttribute("data-theme",s),localStorage.setItem("studio-theme",s);const n=document.querySelector('meta[name="theme-color"]');n&&n.setAttribute("content",s==="dark"?"#0a1628":"#f5f7fa")},[s]),{theme:s,toggleTheme:()=>{t(n=>n==="dark"?"light":"dark")},setTheme:n=>{t(n)},isDark:s==="dark"}};function fe({metrics:s}){if(!s)return null;const t=[{label:"Active Tasks",value:s.total_tasks,icon:"ðŸ“‹",color:"var(--color-accent)"},{label:"At Risk",value:s.at_risk_count,icon:"âš ï¸",color:s.at_risk_count>0?"var(--color-warning)":"var(--color-success)"},{label:"Upcoming Shoots",value:s.upcoming_shoots,icon:"ðŸŽ¬",color:"var(--color-accent)"},{label:"Upcoming Deadlines",value:s.upcoming_deadlines,icon:"â°",color:"var(--color-accent)"}];return e.jsx("div",{className:"status-board",children:t.map((r,a)=>e.jsxs("div",{className:"stat-card",style:{borderColor:r.color},children:[e.jsx("div",{className:"stat-icon",children:r.icon}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",style:{color:r.color},children:r.value}),e.jsx("div",{className:"stat-label",children:r.label})]})]},a))})}function ge({team:s,onMemberClick:t}){if(!s||s.length===0)return null;const r=(a,n)=>{(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),t&&t(n))};return e.jsxs("div",{className:"card team-capacity",children:[e.jsx("h2",{id:"team-capacity-heading",children:"ðŸ‘¥ Team Capacity"}),e.jsx("div",{className:"team-grid",role:"list","aria-labelledby":"team-capacity-heading",children:s.map((a,n)=>{const o=a.max>0?a.current/a.max*100:0,c=o>100?"overloaded":o>80?"high":"normal",h=c==="overloaded"?"overloaded":c==="high"?"high capacity":"normal capacity";return e.jsxs("div",{className:`team-member ${c} clickable`,role:"listitem button",tabIndex:0,"aria-label":`${a.name} - ${o.toFixed(0)}% capacity utilized, ${h}. Current: ${a.current} hours, Maximum: ${a.max} hours. Press Enter or Space to view details.`,onClick:()=>t&&t(a),onKeyDown:b=>r(b,a),children:[e.jsxs("div",{className:"member-header",children:[e.jsx("div",{className:"member-name","aria-hidden":"true",children:a.name}),e.jsxs("div",{className:"member-utilization","aria-hidden":"true",children:[o.toFixed(0),"%"]})]}),e.jsx("div",{className:"capacity-bar-bg",children:e.jsx("div",{className:`capacity-bar ${c}`,style:{width:`${Math.min(o,100)}%`},role:"progressbar","aria-valuenow":o,"aria-valuemin":0,"aria-valuemax":100,"aria-label":`Capacity utilization: ${o.toFixed(1)}%`,"aria-hidden":"true"})}),e.jsx("div",{className:"capacity-numbers","aria-hidden":"true",children:e.jsxs("span",{children:[a.current,"h / ",a.max,"h"]})})]},n)})})]})}const Ne=m.memo(ge);function be({tasks:s,onTaskClick:t}){const r=(a,n)=>{(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),t&&t(n))};return!s||s.length===0?e.jsxs("div",{className:"card at-risk-tasks",children:[e.jsx("h2",{id:"at-risk-heading",children:"âš ï¸ At-Risk Tasks"}),e.jsxs("div",{className:"no-tasks",role:"status","aria-live":"polite",children:[e.jsx("div",{className:"success-icon","aria-hidden":"true",children:"âœ…"}),e.jsx("p",{children:"No tasks currently at risk!"})]})]}):e.jsxs("div",{className:"card at-risk-tasks",children:[e.jsx("h2",{id:"at-risk-heading",children:"âš ï¸ At-Risk Tasks"}),e.jsxs("div",{className:"task-count","aria-live":"polite",children:[s.length," task",s.length!==1?"s":""," at risk"]}),e.jsx("div",{className:"risk-list",role:"list","aria-labelledby":"at-risk-heading",children:s.slice(0,10).map((a,n)=>{const o=a.risks?a.risks.join(", "):"No specific risk factors listed";return e.jsxs("div",{className:"risk-item clickable",role:"listitem button",tabIndex:0,"aria-label":`At-risk task: ${a.name} in project ${a.project}. Assigned to ${a.assignee}${a.due_on?`, due ${a.due_on}`:""}. Risk factors: ${o}. Press Enter or Space for details.`,onClick:()=>t&&t(a),onKeyDown:c=>r(c,a),children:[e.jsxs("div",{className:"risk-header",children:[e.jsx("div",{className:"task-name","aria-hidden":"true",children:a.name}),e.jsx("div",{className:"task-project","aria-hidden":"true",children:a.project})]}),e.jsxs("div",{className:"task-meta","aria-hidden":"true",children:[e.jsxs("span",{children:["ðŸ‘¤ ",a.assignee]}),a.videographer&&e.jsxs("span",{children:["ðŸŽ¥ ",a.videographer]}),a.due_on&&e.jsxs("span",{children:["ðŸ“… ",a.due_on]})]}),e.jsx("div",{className:"risk-factors","aria-hidden":"true",children:a.risks&&a.risks.map((c,h)=>e.jsxs("div",{className:"risk-factor",children:["â€¢ ",c]},h))})]},n)})})]})}const ye=m.memo(be);function ke({shoots:s,deadlines:t,onShootClick:r,onDeadlineClick:a}){return e.jsxs("div",{className:"card upcoming-events",children:[e.jsx("h2",{children:"ðŸ“… Upcoming Events"}),e.jsxs("div",{className:"events-sections",children:[e.jsxs("div",{className:"event-section",children:[e.jsx("h3",{children:"ðŸŽ¬ Shoots"}),!s||s.length===0?e.jsx("div",{className:"no-events",children:"No upcoming shoots"}):e.jsx("div",{className:"event-list",children:s.slice(0,5).map((n,o)=>{const c=q(n.datetime),h=le(c,new Date);return e.jsxs("div",{className:"event-item shoot clickable",onClick:()=>r&&r(n),children:[e.jsxs("div",{className:"event-header",children:[e.jsx("div",{className:"event-name",children:n.name}),e.jsx("div",{className:`days-badge ${h<=2?"urgent":""}`,children:h===0?"Today":h===1?"Tomorrow":`${h}d`})]}),e.jsxs("div",{className:"event-meta",children:[e.jsxs("span",{children:["ðŸ“… ",W(c,"MMM d, h:mm a")]}),e.jsxs("span",{children:["ðŸ“ ",n.project]})]})]},o)})})]}),e.jsxs("div",{className:"event-section",children:[e.jsx("h3",{children:"â° Deadlines"}),!t||t.length===0?e.jsx("div",{className:"no-events",children:"No upcoming deadlines"}):e.jsx("div",{className:"event-list",children:t.slice(0,5).map((n,o)=>{const c=q(n.due_date),h=n.days_until;return e.jsxs("div",{className:"event-item deadline clickable",onClick:()=>a&&a(n),children:[e.jsxs("div",{className:"event-header",children:[e.jsx("div",{className:"event-name",children:n.name}),e.jsx("div",{className:`days-badge ${h<=2?"urgent":h<=5?"warning":""}`,children:h===0?"Today":h===1?"Tomorrow":`${h}d`})]}),e.jsxs("div",{className:"event-meta",children:[e.jsxs("span",{children:["ðŸ“… ",W(c,"MMM d, yyyy")]}),e.jsxs("span",{children:["ðŸ“ ",n.project]})]})]},o)})})]})]})]})}function Se({theme:s,onToggle:t}){const r=s==="dark";return e.jsxs("button",{className:"theme-toggle",onClick:t,"aria-label":`Switch to ${r?"light":"dark"} mode`,title:`Switch to ${r?"light":"dark"} mode`,children:[e.jsx("div",{className:"theme-toggle-track",children:e.jsx("div",{className:`theme-toggle-thumb ${r?"dark":"light"}`,children:r?"ðŸŒ™":"â˜€ï¸"})}),e.jsx("span",{className:"theme-toggle-label",children:r?"Dark":"Light"})]})}const we=async(s={})=>{try{const{includeCharts:t=!0}=s,r=new ne("p","mm","a4"),a=r.internal.pageSize.getWidth(),n=r.internal.pageSize.getHeight();let o=20;r.setFontSize(20),r.setTextColor(96,187,233),r.text("Studio Command Center Report",a/2,o,{align:"center"}),o+=15,r.setFontSize(12),r.setTextColor(128,128,128);const c=new Date().toLocaleString();if(r.text(`Generated: ${c}`,a/2,o,{align:"center"}),o+=20,t){const g=document.querySelector(".dashboard-grid");if(g)try{const N=await oe(g,{scale:1,useCORS:!0,allowTaint:!0,backgroundColor:null}),y=N.toDataURL("image/png"),i=a-20,d=N.height*i/N.width;o+d>n-20&&(r.addPage(),o=20),r.addImage(y,"PNG",10,o,i,d),o+=d+10}catch(N){console.warn("Failed to capture dashboard screenshot:",N),r.setFontSize(14),r.setTextColor(255,0,0),r.text("Dashboard visualization could not be captured",20,o),o+=20}}const h=Ae(),b=`studio-dashboard-${R(new Date,{representation:"date"})}.pdf`;r.save(b)}catch(t){throw console.error("PDF export failed:",t),new Error("Failed to export PDF. Please try again.")}},Y=(s,t)=>{try{let r=[],a="";switch(t){case"tasks":r=_e(s.at_risk_tasks),a=`at-risk-tasks-${R(new Date,{representation:"date"})}.csv`;break;case"team":r=Ee(s.team_capacity),a=`team-capacity-${R(new Date,{representation:"date"})}.csv`;break;case"shoots":r=Te(s.upcoming_shoots),a=`upcoming-shoots-${R(new Date,{representation:"date"})}.csv`;break;case"deadlines":r=Re(s.upcoming_deadlines),a=`upcoming-deadlines-${R(new Date,{representation:"date"})}.csv`;break;case"all":r=De(s),a=`studio-dashboard-${R(new Date,{representation:"date"})}.csv`;break;default:throw new Error("Invalid export type")}const n=de.unparse(r);Pe(n,a)}catch(r){throw console.error("CSV export failed:",r),new Error("Failed to export CSV. Please try again.")}},Ce=s=>{try{const t={timestamp:new Date().toISOString(),data:s,metadata:{version:"1.0",source:"Studio Command Center"}},r=JSON.stringify(t,null,2),a=`studio-dashboard-${R(new Date,{representation:"date"})}.json`;$e(r,a)}catch(t){throw console.error("JSON export failed:",t),new Error("Failed to export JSON. Please try again.")}},_e=s=>s.map(t=>{var r,a;return{"Task Name":t.name,Project:t.project,Assignee:t.assignee,"Due Date":t.due_date||t.due_on||"",Status:t.status,Priority:t.priority||"","Risk Factors":((r=t.risks)==null?void 0:r.join("; "))||((a=t.reasons)==null?void 0:a.join("; "))||"",Videographer:t.videographer||""}}),Ee=s=>s.map(t=>{const r=t.max>0?(t.current/t.max*100).toFixed(1):"0";return{Name:t.name,"Current Hours":t.current,"Max Hours":t.max,"Utilization %":r,"Available Hours":t.max-t.current,Status:t.status||(parseFloat(r)>100?"overloaded":parseFloat(r)>80?"high":"normal")}}),Te=s=>s.map(t=>({"Shoot Name":t.name,Date:t.date,Time:t.time||"",Location:t.location||"",Client:t.client||"",Crew:Array.isArray(t.crew)?t.crew.join("; "):t.crew||"",Status:t.status||""})),Re=s=>s.map(t=>({"Deadline Name":t.name,Date:t.date,Project:t.project,Assignee:t.assignee||"",Priority:t.priority||"",Status:t.status||"",Type:t.type||""})),De=s=>[{Type:"Summary","Total Tasks":s.metrics.total_tasks,"At-Risk Tasks":s.metrics.at_risk_count,"Upcoming Shoots":s.metrics.upcoming_shoots,"Upcoming Deadlines":s.metrics.upcoming_deadlines,"Team Utilization":s.metrics.team_utilization||"","Overloaded Members":s.metrics.overloaded_members||""}],Ae=()=>null,Pe=(s,t)=>{const r=new Blob([s],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),n=URL.createObjectURL(r);a.setAttribute("href",n),a.setAttribute("download",t),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)},$e=(s,t)=>{const r=new Blob([s],{type:"application/json;charset=utf-8;"}),a=document.createElement("a"),n=URL.createObjectURL(r);a.setAttribute("href",n),a.setAttribute("download",t),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)};function Me({data:s,disabled:t=!1}){const[r,a]=m.useState(!1),[n,o]=m.useState(!1),[c,h]=m.useState(""),b=m.useRef(null);m.useEffect(()=>{const y=i=>{b.current&&!b.current.contains(i.target)&&a(!1)};return document.addEventListener("mousedown",y),()=>document.removeEventListener("mousedown",y)},[]);const g=async(y,i)=>{if(!(!s||n)){o(!0),h(y),a(!1);try{switch(y){case"pdf":await we({includeCharts:!0});break;case"csv":i?Y(s,i):Y(s,"all");break;case"json":Ce(s);break;default:throw new Error("Unsupported export format")}N("Export completed successfully!","success")}catch(d){console.error("Export failed:",d),N("Export failed. Please try again.","error")}finally{o(!1),h("")}}},N=(y,i)=>{const d=document.createElement("div");d.className=`export-notification ${i}`,d.textContent=y,d.style.cssText=`
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 12px 20px;
      border-radius: 8px;
      color: white;
      font-weight: 500;
      z-index: 10000;
      animation: slideInRight 0.3s ease;
      background: ${i==="success"?"#22c55e":"#ef4444"};
    `,document.body.appendChild(d),setTimeout(()=>{d.style.animation="slideOutRight 0.3s ease",setTimeout(()=>{document.body.contains(d)&&document.body.removeChild(d)},300)},3e3)};return e.jsxs("div",{className:"export-menu",ref:b,children:[e.jsx("button",{className:"export-trigger",onClick:()=>a(!r),disabled:t||!s||n,"aria-label":"Export dashboard data","aria-expanded":r,"aria-haspopup":"true",children:n?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner","aria-hidden":"true",children:"â³"}),"Exporting..."]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{"aria-hidden":"true",children:"ðŸ“¥"}),"Export"]})}),r&&!n&&e.jsxs("div",{className:"export-dropdown",role:"menu",children:[e.jsxs("div",{className:"export-section",children:[e.jsx("div",{className:"export-section-title",children:"PDF Report"}),e.jsxs("button",{className:"export-option",onClick:()=>g("pdf"),role:"menuitem",children:[e.jsx("span",{className:"export-icon",children:"ðŸ“„"}),e.jsxs("div",{className:"export-details",children:[e.jsx("div",{className:"export-name",children:"Full Dashboard"}),e.jsx("div",{className:"export-description",children:"Complete report with charts"})]})]})]}),e.jsxs("div",{className:"export-section",children:[e.jsx("div",{className:"export-section-title",children:"CSV Data"}),e.jsxs("button",{className:"export-option",onClick:()=>g("csv","all"),role:"menuitem",children:[e.jsx("span",{className:"export-icon",children:"ðŸ“Š"}),e.jsxs("div",{className:"export-details",children:[e.jsx("div",{className:"export-name",children:"Summary Data"}),e.jsx("div",{className:"export-description",children:"Key metrics and counts"})]})]}),e.jsxs("button",{className:"export-option",onClick:()=>g("csv","tasks"),role:"menuitem",children:[e.jsx("span",{className:"export-icon",children:"âš ï¸"}),e.jsxs("div",{className:"export-details",children:[e.jsx("div",{className:"export-name",children:"At-Risk Tasks"}),e.jsx("div",{className:"export-description",children:"Task details and risk factors"})]})]}),e.jsxs("button",{className:"export-option",onClick:()=>g("csv","team"),role:"menuitem",children:[e.jsx("span",{className:"export-icon",children:"ðŸ‘¥"}),e.jsxs("div",{className:"export-details",children:[e.jsx("div",{className:"export-name",children:"Team Capacity"}),e.jsx("div",{className:"export-description",children:"Member utilization data"})]})]}),e.jsxs("button",{className:"export-option",onClick:()=>g("csv","shoots"),role:"menuitem",children:[e.jsx("span",{className:"export-icon",children:"ðŸŽ¬"}),e.jsxs("div",{className:"export-details",children:[e.jsx("div",{className:"export-name",children:"Upcoming Shoots"}),e.jsx("div",{className:"export-description",children:"Shoot schedule and details"})]})]}),e.jsxs("button",{className:"export-option",onClick:()=>g("csv","deadlines"),role:"menuitem",children:[e.jsx("span",{className:"export-icon",children:"ðŸ“…"}),e.jsxs("div",{className:"export-details",children:[e.jsx("div",{className:"export-name",children:"Deadlines"}),e.jsx("div",{className:"export-description",children:"Upcoming deadline list"})]})]})]}),e.jsxs("div",{className:"export-section",children:[e.jsx("div",{className:"export-section-title",children:"Raw Data"}),e.jsxs("button",{className:"export-option",onClick:()=>g("json"),role:"menuitem",children:[e.jsx("span",{className:"export-icon",children:"ðŸ—‚ï¸"}),e.jsxs("div",{className:"export-details",children:[e.jsx("div",{className:"export-name",children:"JSON Export"}),e.jsx("div",{className:"export-description",children:"Complete data structure"})]})]})]})]})]})}function Q({lastUpdate:s,onRefresh:t,autoRefresh:r,onToggleAutoRefresh:a,loading:n,theme:o,onToggleTheme:c,data:h}){return e.jsx("header",{className:"header",children:e.jsxs("div",{className:"header-content",children:[e.jsx("h1",{children:"âœ¦ Studio Command Center âœ¦"}),e.jsxs("div",{className:"header-controls",children:[e.jsx("div",{className:"last-update",role:"status","aria-live":"polite",children:s&&e.jsxs("span",{children:["Last updated ",ce(s,{addSuffix:!0})]})}),e.jsxs("div",{className:"control-group",children:[e.jsx(Me,{data:h,disabled:n}),o&&c&&e.jsx(Se,{theme:o,onToggle:c}),e.jsxs("button",{className:"auto-refresh-toggle",onClick:a,"aria-label":`Auto-refresh is currently ${r?"enabled":"disabled"}. Click to ${r?"disable":"enable"} auto-refresh.`,"aria-pressed":r,title:r?"Auto-refresh enabled":"Auto-refresh disabled",children:[e.jsx("span",{className:`status-dot ${r?"normal":""}`,"aria-hidden":"true"}),"Auto-refresh"]}),e.jsxs("button",{className:"refresh-btn",onClick:t,disabled:n,"aria-label":n?"Refreshing dashboard data...":"Refresh dashboard data",children:[e.jsx("span",{className:n?"spinning":"","aria-hidden":"true",children:"ðŸ”„"}),n?"Refreshing...":"Refresh"]})]})]})]})})}function Fe({filters:s,onFiltersChange:t,data:r}){const[a,n]=m.useState(!1),[o,c]=m.useState(s.search);m.useEffect(()=>{const i=setTimeout(()=>{t({...s,search:o})},300);return()=>clearTimeout(i)},[o]);const h=m.useMemo(()=>{var D,E,A,$;if(!r)return{projects:[],teamMembers:[],statuses:[],priorities:[]};const i=new Set,d=new Set,w=new Set,_=new Set;return(D=r.at_risk_tasks)==null||D.forEach(l=>{l.project&&i.add(l.project),l.assignee&&d.add(l.assignee),l.status&&w.add(l.status),l.priority!==void 0&&_.add(l.priority.toString())}),(E=r.team_capacity)==null||E.forEach(l=>{d.add(l.name),l.status&&w.add(l.status)}),(A=r.upcoming_shoots)==null||A.forEach(l=>{l.status&&w.add(l.status)}),($=r.upcoming_deadlines)==null||$.forEach(l=>{l.project&&i.add(l.project),l.assignee&&d.add(l.assignee),l.status&&w.add(l.status),l.priority&&_.add(l.priority)}),{projects:Array.from(i).sort().map(l=>({value:l,label:l})),teamMembers:Array.from(d).sort().map(l=>({value:l,label:l})),statuses:Array.from(w).sort().map(l=>({value:l,label:l})),priorities:Array.from(_).sort().map(l=>({value:l,label:l}))}},[r]),b=(i,d)=>{t({...s,[i]:d})},g=(i,d,w)=>{const _=s[i]||[],D=w?[..._,d]:_.filter(E=>E!==d);b(i,D)},N=()=>{c(""),t({search:"",project:"",teamMember:"",sortBy:"date",status:[],priority:[]})},y=s.search||s.project||s.teamMember||s.status&&s.status.length>0||s.priority&&s.priority.length>0;return e.jsxs("div",{className:"advanced-filter-bar",children:[e.jsxs("div",{className:"filter-header",children:[e.jsx("div",{className:"search-section",children:e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx("span",{className:"search-icon","aria-hidden":"true",children:"ðŸ”"}),e.jsx("input",{type:"text",placeholder:"Search tasks, projects, team members...",value:o,onChange:i=>c(i.target.value),className:"search-input","aria-label":"Search dashboard content"}),o&&e.jsx("button",{className:"clear-search",onClick:()=>c(""),"aria-label":"Clear search",children:"âœ•"})]})}),e.jsxs("div",{className:"filter-controls",children:[e.jsxs("button",{className:"filter-toggle",onClick:()=>n(!a),"aria-expanded":a,"aria-label":`${a?"Hide":"Show"} advanced filters`,children:[e.jsx("span",{"aria-hidden":"true",children:"ðŸ”§"}),"Filters",e.jsx("span",{className:`chevron ${a?"expanded":""}`,"aria-hidden":"true",children:"â–¼"})]}),y&&e.jsxs("button",{className:"clear-filters",onClick:N,"aria-label":"Clear all filters",children:[e.jsx("span",{"aria-hidden":"true",children:"âœ•"}),"Clear All"]})]})]}),a&&e.jsxs("div",{className:"filter-panel",children:[e.jsxs("div",{className:"filter-grid",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"sort-select",className:"filter-label",children:"Sort By"}),e.jsxs("select",{id:"sort-select",value:s.sortBy,onChange:i=>b("sortBy",i.target.value),className:"filter-select",children:[e.jsx("option",{value:"date",children:"Date"}),e.jsx("option",{value:"priority",children:"Priority"}),e.jsx("option",{value:"project",children:"Project"}),e.jsx("option",{value:"assignee",children:"Assignee"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"project-select",className:"filter-label",children:"Project"}),e.jsxs("select",{id:"project-select",value:s.project,onChange:i=>b("project",i.target.value),className:"filter-select",children:[e.jsx("option",{value:"",children:"All Projects"}),h.projects.map(i=>e.jsx("option",{value:i.value,children:i.label},i.value))]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{htmlFor:"team-select",className:"filter-label",children:"Team Member"}),e.jsxs("select",{id:"team-select",value:s.teamMember,onChange:i=>b("teamMember",i.target.value),className:"filter-select",children:[e.jsx("option",{value:"",children:"All Members"}),h.teamMembers.map(i=>e.jsx("option",{value:i.value,children:i.label},i.value))]})]})]}),e.jsxs("div",{className:"multi-select-section",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("div",{className:"filter-label",children:"Status"}),e.jsx("div",{className:"checkbox-group",children:h.statuses.map(i=>e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:(s.status||[]).includes(i.value),onChange:d=>g("status",i.value,d.target.checked),className:"checkbox-input"}),e.jsx("span",{className:"checkbox-text",children:i.label})]},i.value))})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("div",{className:"filter-label",children:"Priority"}),e.jsx("div",{className:"checkbox-group",children:h.priorities.map(i=>e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:(s.priority||[]).includes(i.value),onChange:d=>g("priority",i.value,d.target.checked),className:"checkbox-input"}),e.jsx("span",{className:"checkbox-text",children:i.label})]},i.value))})]})]})]}),y&&e.jsxs("div",{className:"active-filters",children:[e.jsx("span",{className:"active-filters-label",children:"Active filters:"}),s.search&&e.jsxs("span",{className:"filter-chip",children:['Search: "',s.search,'"',e.jsx("button",{onClick:()=>c(""),"aria-label":"Remove search filter",children:"âœ•"})]}),s.project&&e.jsxs("span",{className:"filter-chip",children:["Project: ",s.project,e.jsx("button",{onClick:()=>b("project",""),"aria-label":"Remove project filter",children:"âœ•"})]}),s.teamMember&&e.jsxs("span",{className:"filter-chip",children:["Team: ",s.teamMember,e.jsx("button",{onClick:()=>b("teamMember",""),"aria-label":"Remove team member filter",children:"âœ•"})]}),(s.status||[]).map(i=>e.jsxs("span",{className:"filter-chip",children:["Status: ",i,e.jsx("button",{onClick:()=>g("status",i,!1),"aria-label":`Remove status filter: ${i}`,children:"âœ•"})]},i)),(s.priority||[]).map(i=>e.jsxs("span",{className:"filter-chip",children:["Priority: ",i,e.jsx("button",{onClick:()=>g("priority",i,!1),"aria-label":`Remove priority filter: ${i}`,children:"âœ•"})]},i))]})]})}function P({type:s="default",height:t}){return e.jsxs("div",{className:`skeleton-card ${s}`,style:{height:t},children:[e.jsxs("div",{className:"skeleton-header",children:[e.jsx("div",{className:"skeleton-title"}),e.jsx("div",{className:"skeleton-badge"})]}),e.jsxs("div",{className:"skeleton-content",children:[s==="chart"&&e.jsxs("div",{className:"skeleton-chart",children:[e.jsx("div",{className:"skeleton-chart-bar",style:{height:"60%"}}),e.jsx("div",{className:"skeleton-chart-bar",style:{height:"80%"}}),e.jsx("div",{className:"skeleton-chart-bar",style:{height:"45%"}}),e.jsx("div",{className:"skeleton-chart-bar",style:{height:"70%"}}),e.jsx("div",{className:"skeleton-chart-bar",style:{height:"35%"}})]}),s==="team"&&e.jsx("div",{className:"skeleton-team",children:[...Array(4)].map((r,a)=>e.jsxs("div",{className:"skeleton-team-member",children:[e.jsxs("div",{className:"skeleton-member-header",children:[e.jsx("div",{className:"skeleton-member-name"}),e.jsx("div",{className:"skeleton-member-util"})]}),e.jsx("div",{className:"skeleton-progress-bar"}),e.jsx("div",{className:"skeleton-member-details"})]},a))}),s==="list"&&e.jsx("div",{className:"skeleton-list",children:[...Array(5)].map((r,a)=>e.jsx("div",{className:"skeleton-list-item",children:e.jsxs("div",{className:"skeleton-list-content",children:[e.jsx("div",{className:"skeleton-list-title"}),e.jsx("div",{className:"skeleton-list-subtitle"}),e.jsx("div",{className:"skeleton-list-meta"})]})},a))}),s==="default"&&e.jsxs("div",{className:"skeleton-default",children:[e.jsx("div",{className:"skeleton-line"}),e.jsx("div",{className:"skeleton-line"}),e.jsx("div",{className:"skeleton-line short"}),e.jsx("div",{className:"skeleton-line medium"})]})]})]})}const Oe=m.lazy(()=>X(()=>import("./DetailModal-BsqAyIVa.js"),__vite__mapDeps([0,1,2,3,4,5]))),Le=m.lazy(()=>X(()=>import("./ProjectInsights-CMS8qvkk.js"),__vite__mapDeps([6,2,3,1,4,7])));function Ie(){const{theme:s,toggleTheme:t}=ve(),[r,a]=m.useState(null),[n,o]=m.useState(!0),[c,h]=m.useState(null),[b,g]=m.useState(null),[N,y]=m.useState(!0),[i,d]=m.useState({search:"",project:"",teamMember:"",sortBy:"date",status:[],priority:[]}),[w,_]=m.useState(null),[D,E]=m.useState(null),A=async()=>{try{const x=await fetch("/api/dashboard");if(!x.ok)throw new Error("Failed to fetch data");const C=await x.json();a(C),g(new Date),h(null)}catch(x){const C=x instanceof Error?x.message:"Unknown error occurred";h(C),console.error("Error fetching data:",x)}finally{o(!1)}},$=async()=>{o(!0),await fetch("/api/refresh"),await A()},l=(x,C)=>{_(x),E(C)},se=()=>{_(null),E(null)},p=m.useMemo(()=>{if(!r)return null;const x=(u,j)=>{if(!i.search)return u;const v=i.search.toLowerCase();return u.filter(f=>{const F=j(f),O=f.project||"",L=f.assignee||f.name||"";return F.toLowerCase().includes(v)||O.toLowerCase().includes(v)||L.toLowerCase().includes(v)})},C=u=>i.project?u.filter(j=>j.project===i.project):u,V=u=>i.teamMember?u.filter(j=>j.assignee===i.teamMember||j.name===i.teamMember):u,U=u=>!i.status||i.status.length===0?u:u.filter(j=>j.status&&i.status.includes(j.status)),H=u=>!i.priority||i.priority.length===0?u:u.filter(j=>{var f;const v=((f=j.priority)==null?void 0:f.toString())||"";return v&&i.priority.includes(v)}),z=u=>{const j=[...u];switch(i.sortBy){case"priority":return j.sort((v,f)=>{var L,J;const F=parseInt(((L=v.priority)==null?void 0:L.toString())||"0");return parseInt(((J=f.priority)==null?void 0:J.toString())||"0")-F});case"project":return j.sort((v,f)=>(v.project||"").localeCompare(f.project||""));case"assignee":return j.sort((v,f)=>(v.assignee||v.name||"").localeCompare(f.assignee||f.name||""));case"date":default:return j.sort((v,f)=>{const F=new Date(v.due_date||v.due_on||v.date||0),O=new Date(f.due_date||f.due_on||f.date||0);return F.getTime()-O.getTime()})}};let k=r.at_risk_tasks||[];k=x(k,u=>u.name),k=C(k),k=V(k),k=U(k),k=H(k),k=z(k);let T=r.upcoming_shoots||[];T=x(T,u=>u.name),T=U(T),T=z(T);let S=r.upcoming_deadlines||[];S=x(S,u=>u.name),S=C(S),S=V(S),S=U(S),S=H(S),S=z(S);let M=r.team_capacity||[];return i.teamMember&&(M=M.filter(u=>u.name===i.teamMember)),i.status&&i.status.length>0&&(M=M.filter(u=>{const j=u.max>0?u.current/u.max*100:0,v=j>100?"overloaded":j>80?"high":"normal";return i.status.includes(v)||i.status.includes(u.status||"")})),{...r,at_risk_tasks:k,upcoming_shoots:T,upcoming_deadlines:S,team_capacity:M}},[r,i]);return m.useEffect(()=>{A()},[]),m.useEffect(()=>{if(!N)return;const x=setInterval(()=>{A()},12e4);return()=>clearInterval(x)},[N]),n&&!r?e.jsxs("div",{className:"app",children:[e.jsx(Q,{lastUpdate:null,onRefresh:()=>{},autoRefresh:N,onToggleAutoRefresh:()=>y(!N),loading:!0,theme:s,onToggleTheme:t,data:null}),e.jsxs("main",{className:"dashboard-grid",children:[e.jsx(P,{type:"default"}),e.jsx(P,{type:"team"}),e.jsx(P,{type:"chart",height:"300px"}),e.jsxs("div",{className:"grid-row-2col",children:[e.jsx(P,{type:"list"}),e.jsx(P,{type:"list"})]})]})]}):c&&!r?e.jsxs("div",{className:"error-container",children:[e.jsx("h2",{children:"âš ï¸ Error Loading Data"}),e.jsx("p",{children:c}),e.jsx("button",{onClick:$,children:"Retry"})]}):e.jsxs("div",{className:"app",children:[e.jsx(Q,{lastUpdate:b,onRefresh:$,autoRefresh:N,onToggleAutoRefresh:()=>y(!N),loading:n,theme:s,onToggleTheme:t,data:r}),e.jsxs("main",{className:"dashboard-grid",children:[e.jsx(Fe,{filters:i,onFiltersChange:d,data:r}),e.jsx(fe,{metrics:p==null?void 0:p.metrics}),e.jsx(Ne,{team:p==null?void 0:p.team_capacity,onMemberClick:x=>d(C=>({...C,teamMember:x.name}))}),e.jsx(m.Suspense,{fallback:e.jsx(P,{type:"chart",height:"300px"}),children:e.jsx(Le,{tasks:p==null?void 0:p.at_risk_tasks,team:p==null?void 0:p.team_capacity,shoots:p==null?void 0:p.upcoming_shoots,deadlines:p==null?void 0:p.upcoming_deadlines})}),e.jsxs("div",{className:"grid-row-2col",children:[e.jsx(ye,{tasks:p==null?void 0:p.at_risk_tasks,onTaskClick:x=>l(x,"task")}),e.jsx(ke,{shoots:p==null?void 0:p.upcoming_shoots,deadlines:p==null?void 0:p.upcoming_deadlines,onShootClick:x=>l(x,"shoot"),onDeadlineClick:x=>l(x,"deadline")})]})]}),w&&e.jsx(m.Suspense,{fallback:e.jsx("div",{className:"modal-loading",children:"Loading details..."}),children:e.jsx(Oe,{item:w,type:D,onClose:se})})]})}class Ue extends m.Component{constructor(r){super(r);K(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(r){return{hasError:!0}}componentDidCatch(r,a){console.error("Dashboard Error:",r,a),this.setState({error:r,errorInfo:a})}render(){var r;if(this.state.hasError){const{fallback:a}=this.props;return a?e.jsx(a,{error:this.state.error,errorInfo:this.state.errorInfo,resetError:this.handleReset}):e.jsx("div",{className:"error-container",children:e.jsxs("div",{className:"error-content",children:[e.jsx("h2",{children:"ðŸš¨ Something went wrong"}),e.jsx("p",{children:((r=this.state.error)==null?void 0:r.message)||"An unexpected error occurred in the dashboard."}),e.jsxs("div",{className:"error-actions",children:[e.jsx("button",{onClick:this.handleReset,className:"retry-button",children:"Try Again"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"reload-button",children:"Reload Dashboard"})]}),!1]})})}return this.props.children}}B.createRoot(document.getElementById("root")).render(e.jsx(ie.StrictMode,{children:e.jsx(Ue,{children:e.jsx(Ie,{})})}));export{e as j};
